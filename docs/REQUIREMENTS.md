# 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
**Okiteru（おきてる）** - スタッフ勤怠・日報管理システム

### 1.2 背景・目的
通信事業部のスタッフ管理において、以下の課題が存在する：
- スタッフの日々の勤怠状況（起床・出発・到着）の把握が困難
- 現場到着の確認や遅延の早期発見ができない
- 日報の提出漏れや内容の確認に時間がかかる
- スタッフのスケジュール管理が煩雑

**本システムの目的**:
1. スタッフの勤怠状況をリアルタイムで可視化
2. 前日報告による翌日の予定把握と準備
3. 日報の提出促進と一元管理
4. マネージャーの管理業務効率化

### 1.3 対象ユーザー
- **スタッフ**: 勤怠報告、日報提出、スケジュール登録
- **マネージャー**: スタッフ管理、勤怠・日報閲覧、現場マスタ管理

---

## 2. 機能要件

### 2.1 認証・ユーザー管理

#### 2.1.1 ユーザー登録・ログイン
| ID | 要件 | 優先度 |
|----|------|--------|
| AUTH-001 | メールアドレスとパスワードでユーザー登録できる | 必須 |
| AUTH-002 | メールアドレスとパスワードでログインできる | 必須 |
| AUTH-003 | ログアウト機能を提供する | 必須 |
| AUTH-004 | パスワードリセット機能を提供する | 必須 |
| AUTH-005 | セッション有効期限は1時間とする | 必須 |
| AUTH-006 | リフレッシュトークンで自動再ログインできる | 推奨 |

#### 2.1.2 ロール・権限管理
| ID | 要件 | 優先度 |
|----|------|--------|
| AUTH-101 | ユーザーロールは「スタッフ」「マネージャー」の2種類とする | 必須 |
| AUTH-102 | スタッフは自分のデータのみアクセスできる | 必須 |
| AUTH-103 | マネージャーは全スタッフのデータにアクセスできる | 必須 |

---

### 2.2 スタッフ機能

#### 2.2.1 前日報告
| ID | 要件 | 優先度 |
|----|------|--------|
| STAFF-001 | 前日の夜に翌日の予定（起床・出発・到着時刻）を入力できる | 必須 |
| STAFF-002 | 身だしなみ写真をアップロードできる | 必須 |
| STAFF-003 | 経路スクリーンショットをアップロードできる | 必須 |
| STAFF-004 | 前日報告は翌日の勤怠記録と紐付けられる | 必須 |
| STAFF-005 | 前日報告の提出確認画面を表示する | 推奨 |

**画面フロー**:
```
前日報告入力画面
  ├─ 翌日予定入力（起床・出発・到着時刻）
  ├─ 身だしなみ写真アップロード
  ├─ 経路スクリーンショットアップロード
  └─ 提出ボタン → 確認画面 → 完了
```

#### 2.2.2 当日勤怠報告
| ID | 要件 | 優先度 |
|----|------|--------|
| STAFF-101 | 起床時刻を記録できる | 必須 |
| STAFF-102 | 起床場所、備考（健康状態等）を入力できる | 必須 |
| STAFF-103 | 出発時刻を記録できる | 必須 |
| STAFF-104 | 出発場所、目的地、備考（交通状況等）を入力できる | 必須 |
| STAFF-105 | 到着時刻を記録できる | 必須 |
| STAFF-106 | 到着場所、GPS座標、備考（遅延理由等）を入力できる | 必須 |
| STAFF-107 | 各段階で写真をアップロードできる（経路写真、身だしなみ写真） | 必須 |
| STAFF-108 | ワンタップで現在時刻を自動入力できる | 推奨 |
| STAFF-109 | 勤怠ステータス（pending, partial, complete）が自動更新される | 必須 |

**勤怠ステータス遷移**:
```
pending（未報告）
  ↓ 起床報告
partial（一部報告）
  ↓ 出発報告
partial（一部報告）
  ↓ 到着報告
complete（報告完了）
```

#### 2.2.3 日報作成・提出
| ID | 要件 | 優先度 |
|----|------|--------|
| STAFF-201 | 当日の作業内容を日報として記録できる | 必須 |
| STAFF-202 | 日報は勤怠記録と自動的に紐付けられる | 必須 |
| STAFF-203 | 下書き保存機能を提供する | 推奨 |
| STAFF-204 | 提出後の日報を閲覧できる | 必須 |
| STAFF-205 | 過去の日報一覧を表示できる | 必須 |

#### 2.2.4 出社可能日登録
| ID | 要件 | 優先度 |
|----|------|--------|
| STAFF-301 | 出勤可能日をカレンダー形式で登録できる | 必須 |
| STAFF-302 | 勤務予定の現場を選択できる | 必須 |
| STAFF-303 | 備考・メモを追加できる | 推奨 |
| STAFF-304 | 登録済みスケジュールを編集・削除できる | 必須 |

---

### 2.3 マネージャー機能

#### 2.3.1 ダッシュボード
| ID | 要件 | 優先度 |
|----|------|--------|
| MGR-001 | 当日の全スタッフの勤怠状況を一覧表示する | 必須 |
| MGR-002 | 各スタッフの勤怠ステータス（pending, partial, complete）を表示する | 必須 |
| MGR-003 | 未報告・遅延しているスタッフを強調表示する | 必須 |
| MGR-004 | 日付を指定して過去の勤怠状況を確認できる | 必須 |

#### 2.3.2 スタッフ管理
| ID | 要件 | 優先度 |
|----|------|--------|
| MGR-101 | スタッフ一覧を表示する（名前、メール、電話番号、ステータス） | 必須 |
| MGR-102 | スタッフの詳細情報を閲覧できる | 必須 |
| MGR-103 | スタッフの勤怠履歴を表示できる | 必須 |
| MGR-104 | スタッフの日報履歴を表示できる | 必須 |
| MGR-105 | スタッフのアクティブ/非アクティブ状態を変更できる | 必須 |

#### 2.3.3 勤怠・日報管理
| ID | 要件 | 優先度 |
|----|------|--------|
| MGR-201 | 全スタッフの勤怠記録を検索・フィルタできる | 必須 |
| MGR-202 | 日付範囲、スタッフ、ステータスで絞り込みできる | 必須 |
| MGR-203 | 勤怠記録の詳細（写真、備考等）を閲覧できる | 必須 |
| MGR-204 | 全スタッフの日報を検索・閲覧できる | 必須 |
| MGR-205 | CSV形式で勤怠・日報データをエクスポートできる | 推奨 |

#### 2.3.4 スケジュール管理
| ID | 要件 | 優先度 |
|----|------|--------|
| MGR-301 | 全スタッフの出社可能日をカレンダー形式で表示する | 必須 |
| MGR-302 | 現場ごとに出勤予定のスタッフを確認できる | 必須 |
| MGR-303 | スタッフのスケジュールを代理登録・編集できる | 必須 |

#### 2.3.5 現場マスタ管理
| ID | 要件 | 優先度 |
|----|------|--------|
| MGR-401 | 現場（勤務先）の新規登録ができる | 必須 |
| MGR-402 | 現場情報（名前、住所、説明）を編集できる | 必須 |
| MGR-403 | 現場の有効/無効状態を変更できる | 必須 |
| MGR-404 | 現場を削除できる（論理削除） | 必須 |

---

### 2.4 共通機能

#### 2.4.1 画像アップロード
| ID | 要件 | 優先度 |
|----|------|--------|
| COM-001 | JPEG, PNG形式の画像をアップロードできる | 必須 |
| COM-002 | 最大ファイルサイズは20MBとする | 必須 |
| COM-003 | 画像はS3に保存される | 必須 |
| COM-004 | アップロード進捗を表示する | 推奨 |
| COM-005 | 画像プレビュー機能を提供する | 推奨 |

#### 2.4.2 通知
| ID | 要件 | 優先度 |
|----|------|--------|
| COM-101 | 勤怠報告の各段階完了時に成功メッセージを表示する | 必須 |
| COM-102 | エラー発生時にエラーメッセージを表示する | 必須 |
| COM-103 | 日報提出時に確認メッセージを表示する | 必須 |

---

## 3. 非機能要件

### 3.1 パフォーマンス
| ID | 要件 | 目標値 |
|----|------|--------|
| PERF-001 | ページ読み込み時間 | < 2秒 |
| PERF-002 | API レスポンスタイム | < 500ms |
| PERF-003 | 画像アップロード時間（10MB） | < 10秒 |
| PERF-004 | 同時接続ユーザー数 | 100ユーザー |

### 3.2 可用性
| ID | 要件 | 目標値 |
|----|------|--------|
| AVAIL-001 | システム稼働率 | 99.9%（月間ダウンタイム < 43分） |
| AVAIL-002 | 定期メンテナンス | 月1回、深夜帯（02:00-04:00） |

### 3.3 セキュリティ
| ID | 要件 | 優先度 |
|----|------|--------|
| SEC-001 | 全通信はHTTPS/TLS 1.2以上で暗号化される | 必須 |
| SEC-002 | パスワードはハッシュ化して保存する（Cognito） | 必須 |
| SEC-003 | JWTトークンで認証・認可を実施する | 必須 |
| SEC-004 | SQLインジェクション対策を実施する（ORM使用） | 必須 |
| SEC-005 | XSS対策を実施する（サニタイゼーション） | 必須 |
| SEC-006 | CSRF対策を実施する（トークン検証） | 必須 |
| SEC-007 | アクセスログを記録する | 必須 |
| SEC-008 | RDS暗号化を有効化する | 必須 |
| SEC-009 | S3サーバーサイド暗号化を有効化する | 必須 |

### 3.4 ユーザビリティ
| ID | 要件 | 優先度 |
|----|------|--------|
| USAB-001 | レスポンシブデザイン（PC、タブレット、スマホ対応） | 必須 |
| USAB-002 | 直感的なUI/UX設計 | 必須 |
| USAB-003 | エラーメッセージは日本語で分かりやすく表示する | 必須 |
| USAB-004 | ローディング中はスピナーを表示する | 必須 |
| USAB-005 | 操作ガイド・ヘルプページを提供する | 推奨 |

### 3.5 保守性
| ID | 要件 | 優先度 |
|----|------|--------|
| MAINT-001 | ログは30日間保持する | 必須 |
| MAINT-002 | エラーログは90日間保持する | 必須 |
| MAINT-003 | データベースバックアップは毎日実施する | 必須 |
| MAINT-004 | バックアップは7日間保持する | 必須 |

---

## 4. データ要件

### 4.1 データ保持期間
| データ種別 | 保持期間 | 備考 |
|-----------|---------|------|
| ユーザー情報 | 無期限 | 退職時は論理削除 |
| 勤怠記録 | 3年 | 法定保存期間考慮 |
| 日報 | 3年 | 法定保存期間考慮 |
| 前日報告 | 1年 | 翌日の勤怠記録と紐付け |
| 出社可能日 | 6ヶ月 | 過去のスケジュール参照用 |
| アクセスログ | 1年 | セキュリティ監査用 |
| 画像ファイル（S3） | 3年 | 勤怠記録と同期 |

### 4.2 データバックアップ
- **頻度**: 毎日 03:00 JST
- **保持**: 7日間（日次）、4週間（週次）
- **復旧目標**: RPO 24時間、RTO 4時間

---

## 5. 制約事項

### 5.1 技術的制約
| 項目 | 制約内容 |
|------|---------|
| **インフラ** | AWS（RDS、Lambda、S3、Cognito、CloudFront） |
| **データベース** | PostgreSQL（RDS） |
| **フロントエンド** | React + Next.js（Pages Router） |
| **バックエンド** | Python + FastAPI |
| **認証** | AWS Cognito + JWT |
| **ファイルストレージ** | AWS S3 |

### 5.2 業務的制約
| 項目 | 制約内容 |
|------|---------|
| **対象部門** | 通信事業部のみ |
| **利用時間** | 24時間365日（深夜メンテナンス除く） |
| **対象デバイス** | PC、タブレット、スマートフォン |

---

## 6. 画面一覧

### 6.1 スタッフ画面
| # | 画面名 | パス | 説明 |
|---|--------|------|------|
| 1 | ログイン | `/login` | メール・パスワード入力 |
| 2 | ダッシュボード | `/dashboard/attendance` | 勤怠報告（起床・出発・到着） |
| 3 | 日報一覧 | `/dashboard/reports` | 過去の日報表示 |
| 4 | 日報作成 | `/dashboard/reports/new` | 日報入力・提出 |
| 5 | 出社可能日 | `/dashboard/shifts` | スケジュールカレンダー |
| 6 | プロフィール | `/profile` | ユーザー情報表示・編集 |

### 6.2 マネージャー画面
| # | 画面名 | パス | 説明 |
|---|--------|------|------|
| 1 | ダッシュボード | `/manager` | 全スタッフ勤怠状況一覧 |
| 2 | スタッフ一覧 | `/manager/staff` | スタッフリスト |
| 3 | スタッフ詳細 | `/manager/staff/[id]` | 個別スタッフ情報・履歴 |
| 4 | スケジュール管理 | `/manager/shifts` | 全スタッフスケジュール |
| 5 | 現場マスタ | `/manager/worksites` | 現場一覧・編集 |

---

## 7. API エンドポイント一覧

### 7.1 認証API
| メソッド | パス | 説明 |
|---------|------|------|
| POST | `/api/auth/register` | ユーザー登録 |
| POST | `/api/auth/login` | ログイン |
| POST | `/api/auth/logout` | ログアウト |
| POST | `/api/auth/refresh` | トークンリフレッシュ |
| POST | `/api/auth/reset-password` | パスワードリセット |

### 7.2 ユーザーAPI
| メソッド | パス | 説明 |
|---------|------|------|
| GET | `/api/users/me` | 現在のユーザー情報取得 |
| PUT | `/api/users/me` | 現在のユーザー情報更新 |
| GET | `/api/users` | ユーザー一覧（マネージャーのみ） |
| GET | `/api/users/{id}` | ユーザー詳細（マネージャーのみ） |
| PUT | `/api/users/{id}` | ユーザー更新（マネージャーのみ） |

### 7.3 勤怠API
| メソッド | パス | 説明 |
|---------|------|------|
| GET | `/api/attendance` | 勤怠記録一覧 |
| GET | `/api/attendance/{id}` | 勤怠記録詳細 |
| GET | `/api/attendance/today` | 当日の勤怠記録 |
| POST | `/api/attendance/wakeup` | 起床報告 |
| POST | `/api/attendance/departure` | 出発報告 |
| POST | `/api/attendance/arrival` | 到着報告 |
| PUT | `/api/attendance/{id}` | 勤怠記録更新 |

### 7.4 日報API
| メソッド | パス | 説明 |
|---------|------|------|
| GET | `/api/reports` | 日報一覧 |
| GET | `/api/reports/{id}` | 日報詳細 |
| POST | `/api/reports` | 日報作成 |
| PUT | `/api/reports/{id}` | 日報更新 |

### 7.5 前日報告API
| メソッド | パス | 説明 |
|---------|------|------|
| POST | `/api/previous-reports` | 前日報告作成 |
| GET | `/api/previous-reports` | 前日報告一覧 |
| PUT | `/api/previous-reports/{id}` | 前日報告更新 |

### 7.6 出社可能日API
| メソッド | パス | 説明 |
|---------|------|------|
| GET | `/api/availability` | 出社可能日一覧 |
| POST | `/api/availability` | 出社可能日登録 |
| PUT | `/api/availability/{id}` | 出社可能日更新 |
| DELETE | `/api/availability/{id}` | 出社可能日削除 |

### 7.7 現場API
| メソッド | パス | 説明 |
|---------|------|------|
| GET | `/api/worksites` | 現場一覧 |
| GET | `/api/worksites/{id}` | 現場詳細 |
| POST | `/api/worksites` | 現場作成（マネージャーのみ） |
| PUT | `/api/worksites/{id}` | 現場更新（マネージャーのみ） |
| DELETE | `/api/worksites/{id}` | 現場削除（マネージャーのみ） |

### 7.8 ファイルAPI
| メソッド | パス | 説明 |
|---------|------|------|
| POST | `/api/upload/image` | 画像アップロード（S3） |

---

## 8. 成功指標（KPI）

| 指標 | 目標値 | 測定方法 |
|------|--------|---------|
| **勤怠報告率** | 95%以上 | 当日報告完了スタッフ数 / 全スタッフ数 |
| **日報提出率** | 90%以上 | 当日日報提出数 / 全スタッフ数 |
| **システム利用率** | 90%以上 | アクティブユーザー数 / 全登録ユーザー数 |
| **マネージャー満足度** | 4.0/5.0以上 | アンケート調査 |
| **ページ読み込み時間** | 2秒以内 | Lighthouse スコア |
| **システム稼働率** | 99.9%以上 | ダウンタイム監視 |

---

## 9. リリース計画

### Phase 1: MVP（最小viable製品）
**リリース予定**: 2025年3月末
- ユーザー登録・ログイン
- 勤怠報告（起床・出発・到着）
- 日報作成・提出
- マネージャーダッシュボード

### Phase 2: 機能拡張
**リリース予定**: 2025年6月末
- 前日報告機能
- 出社可能日登録
- 現場マスタ管理
- CSV エクスポート

### Phase 3: 高度化
**リリース予定**: 2025年9月末
- 通知機能（メール・SMS）
- モバイルアプリ（React Native）
- 分析ダッシュボード
- GPS位置情報検証

---

**作成日**: 2025-12-18
**バージョン**: 1.0
**承認者**: -
